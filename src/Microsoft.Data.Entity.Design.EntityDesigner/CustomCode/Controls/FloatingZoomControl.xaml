<!-- Copyright (c) Microsoft.  All Rights Reserved.  Licensed under the MIT license.  See License.txt in the project root for license information. -->

<UserControl x:Class="Microsoft.Data.Entity.Design.EntityDesigner.View.Controls.FloatingZoomControl"
             x:ClassModifier="internal"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vs="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
             xmlns:theming="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Imaging"
             xmlns:imaging="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.Imaging"
             xmlns:catalog="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.ImageCatalog"
             xmlns:local="clr-namespace:Microsoft.Data.Entity.Design.EntityDesigner.View.Controls"
             mc:Ignorable="d"
             d:DesignWidth="320"
             d:DesignHeight="32"
             FontFamily="{DynamicResource VsFont.EnvironmentFontFamily}"
             FontSize="{DynamicResource VsFont.EnvironmentFontSize}">

    <UserControl.Resources>
        <!-- VS Themed colors - matching context menu styling -->
        <SolidColorBrush x:Key="ControlBackgroundBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.ToolWindowBackgroundColorKey}}"/>
        <SolidColorBrush x:Key="ControlBorderBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.ToolWindowBorderColorKey}}"/>
        <SolidColorBrush x:Key="ControlTextBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.ToolWindowTextColorKey}}"/>
        <SolidColorBrush x:Key="ControlTextDimBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.SystemGrayTextColorKey}}"/>
        <SolidColorBrush x:Key="ButtonHoverBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.CommandBarMouseOverBackgroundBeginColorKey}}"/>
        <SolidColorBrush x:Key="ButtonHoverBorderBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.CommandBarBorderColorKey}}"/>
        <SolidColorBrush x:Key="ButtonPressedBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.CommandBarMouseDownBackgroundBeginColorKey}}"/>
        <SolidColorBrush x:Key="ButtonActiveBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.CommandBarSelectedColorKey}}"/>
        <SolidColorBrush x:Key="SeparatorBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.CommandBarMenuSeparatorColorKey}}"/>
        <SolidColorBrush x:Key="TextBoxBackgroundBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.ComboBoxBackgroundColorKey}}"/>
        <SolidColorBrush x:Key="TextBoxBorderBrush" Color="{DynamicResource {x:Static vs:EnvironmentColors.ComboBoxBorderColorKey}}"/>

        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Zoom Button Style - consistent with context menu button styling -->
        <Style x:Key="ZoomButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{StaticResource ControlTextBrush}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonHoverBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonHoverBorderBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonPressedBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonHoverBorderBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Toggle Button Style for toggle commands -->
        <Style x:Key="ToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{StaticResource ControlTextBrush}"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonActiveBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonHoverBorderBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonHoverBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonHoverBorderBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource ButtonPressedBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonHoverBorderBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Zoom TextBox Style -->
        <Style x:Key="ZoomTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{StaticResource ControlTextBrush}"/>
            <Setter Property="CaretBrush" Value="{StaticResource ControlTextBrush}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="2,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource TextBoxBackgroundBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource TextBoxBorderBrush}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource TextBoxBackgroundBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource ButtonHoverBorderBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Template selector for command items -->
        <local:CommandTemplateSelector x:Key="CommandTemplateSelector">
            <local:CommandTemplateSelector.ButtonTemplate>
                <DataTemplate>
                    <Button Style="{StaticResource ZoomButtonStyle}"
                            Tag="{Binding}"
                            ToolTip="{Binding Tooltip}"
                            IsEnabled="{Binding IsEnabled}"
                            Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                            Click="Command_Click">
                        <imaging:CrispImage Width="16" Height="16" Moniker="{Binding Icon}"/>
                    </Button>
                </DataTemplate>
            </local:CommandTemplateSelector.ButtonTemplate>
            <local:CommandTemplateSelector.ToggleTemplate>
                <DataTemplate>
                    <ToggleButton Style="{StaticResource ToggleButtonStyle}"
                                  Tag="{Binding}"
                                  ToolTip="{Binding Tooltip}"
                                  IsEnabled="{Binding IsEnabled}"
                                  IsChecked="{Binding IsChecked, Mode=TwoWay}"
                                  Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                                  Checked="ToggleCommand_CheckedChanged"
                                  Unchecked="ToggleCommand_CheckedChanged">
                        <imaging:CrispImage Width="16" Height="16" Moniker="{Binding Icon}"/>
                    </ToggleButton>
                </DataTemplate>
            </local:CommandTemplateSelector.ToggleTemplate>
            <local:CommandTemplateSelector.SeparatorTemplate>
                <DataTemplate>
                    <Rectangle Width="1" Height="18"
                               Fill="{StaticResource SeparatorBrush}"
                               Margin="4,0"
                               VerticalAlignment="Center"/>
                </DataTemplate>
            </local:CommandTemplateSelector.SeparatorTemplate>
        </local:CommandTemplateSelector>
    </UserControl.Resources>

    <Border Background="{StaticResource ControlBackgroundBrush}"
            BorderBrush="{StaticResource ControlBorderBrush}"
            BorderThickness="1"
            CornerRadius="6"
            Padding="4,2,4,2"
            theming:ImageThemingUtilities.ImageBackgroundColor="{DynamicResource {x:Static vs:EnvironmentColors.ToolWindowBackgroundColorKey}}">
        <Border.Effect>
            <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.25" Direction="270"/>
        </Border.Effect>

        <StackPanel Orientation="Horizontal">
            <!-- Zoom Out Button -->
            <Button x:Name="ZoomOutButton"
                    Style="{StaticResource ZoomButtonStyle}"
                    ToolTip="Zoom Out"
                    Click="ZoomOutButton_Click">
                <imaging:CrispImage Width="16" Height="16" Moniker="{x:Static catalog:KnownMonikers.ZoomOut}"/>
            </Button>

            <!-- Zoom Percentage TextBox -->
            <TextBox x:Name="ZoomPercentageTextBox"
                     Style="{StaticResource ZoomTextBoxStyle}"
                     Text="100 %"
                     Width="60"
                     ToolTip="Enter zoom percentage"
                     KeyDown="ZoomPercentageTextBox_KeyDown"
                     LostFocus="ZoomPercentageTextBox_LostFocus"/>

            <!-- Zoom In Button -->
            <Button x:Name="ZoomInButton"
                    Style="{StaticResource ZoomButtonStyle}"
                    ToolTip="Zoom In"
                    Click="ZoomInButton_Click">
                <imaging:CrispImage Width="16" Height="16" Moniker="{x:Static catalog:KnownMonikers.ZoomIn}"/>
            </Button>

            <!-- Separator before additional commands (only visible if there are commands) -->
            <Rectangle x:Name="CommandsSeparator"
                       Width="1" Height="18"
                       Fill="{StaticResource SeparatorBrush}"
                       Margin="8,0"
                       VerticalAlignment="Center"
                       Visibility="Collapsed"/>

            <!-- Bindable Commands Container -->
            <ItemsControl x:Name="CommandsContainer"
                          ItemsSource="{Binding Commands, RelativeSource={RelativeSource AncestorType=UserControl}}"
                          ItemTemplateSelector="{StaticResource CommandTemplateSelector}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </StackPanel>
    </Border>
</UserControl>
